# 🎵 音效库集成使用指南

## 📋 概述

已成功将原Coze工作流的音效库集成到ComfyUI中，现在支持**3轨音频系统**：

1. **主音轨**: TTS生成的旁白语音
2. **背景音乐轨**: 史诗感背景音乐（可循环播放）
3. **音效轨**: 开场音效等特殊音效

## 🎯 新增节点

### 🎵 增强视频合成器（3轨音频）
- **节点名称**: `EnhancedVideoComposer`
- **分类**: `🎬 Shenglin/Video`
- **功能**: 支持3轨音频系统的视频合成

## ⚙️ 参数说明

### 🎵 音效相关参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `enable_audio_effects` | BOOLEAN | `True` | 启用音效库（背景音乐+开场音效） |
| `background_music_volume` | FLOAT | `0.3` | 背景音乐音量（30%） |
| `opening_sound_volume` | FLOAT | `0.8` | 开场音效音量（80%） |
| `voice_volume` | FLOAT | `1.0` | 主音轨（语音）音量（100%） |

### 📊 其他参数
- 继承原`VideoComposer`的所有参数
- 支持主角图像开场动画
- 支持多种动画类型（coze_zoom、fade、slide、none）

## 🎵 音效资源

### 开场音效
- **文件**: `opening_sound_effect.mp3`
- **时长**: 4.9秒
- **用途**: 史诗感开场，适合历史故事开头
- **推荐音量**: 80%

### 背景音乐
- **文件**: `background_music.mp3`
- **时长**: 5分44秒（可循环）
- **用途**: 史诗感背景音乐，适合全程播放
- **推荐音量**: 30%

## 🔧 使用方法

### 基本使用
1. 在ComfyUI中找到 `🎵 增强视频合成器（3轨音频）` 节点
2. 连接音频列表和图片输入
3. 启用 `enable_audio_effects` 参数
4. 调整音量参数到合适水平
5. 运行工作流

### 推荐配置
```
enable_audio_effects: True
background_music_volume: 0.3  # 30%背景音乐
opening_sound_volume: 0.8     # 80%开场音效
voice_volume: 1.0             # 100%主音轨
```

### 工作流集成
```
[MiniMax TTS] → [音频列表]
                    ↓
[RunningHub 图像] → [🎵 增强视频合成器] → [MP4视频]
                    ↑
[参数设置] ────────┘
```

## 📊 技术细节

### 3轨音频合成流程
1. **主音轨处理**: 拼接TTS生成的语音片段
2. **背景音乐**: 自动循环匹配视频总时长
3. **开场音效**: 在视频开始前4.9秒播放
4. **音频混合**: 智能混合3轨音频，自动防止剪切
5. **音频同步**: 确保音视频完美同步

### 文件结构
```
comfyui-shenglin/
├── assets/
│   └── audio_effects/
│       ├── opening/
│       │   └── opening_sound_effect.mp3
│       ├── background/
│       │   └── background_music.mp3
│       └── audio_library_config.json
├── audio_effects_manager.py
└── video_system/
    └── enhanced_video_composer.py
```

## 🎯 使用场景

### ✅ 推荐使用3轨音频
- 历史故事视频
- 纪录片风格内容
- 需要史诗感音效的项目
- 专业视频制作

### 🔄 可选单轨模式
- 简单音频需求
- 自定义音效需求
- 调试和测试环境
- 音效库不可用时自动回退

## 🐛 故障排除

### 音效库不可用
**症状**: 节点显示"音效库不可用"
**解决**: 检查`assets/audio_effects/`目录是否存在音频文件

### 音量过大或过小
**症状**: 背景音乐盖过语音或听不到音效
**解决**: 调整音量参数：
- 背景音乐: 0.2-0.4 (20%-40%)
- 开场音效: 0.6-1.0 (60%-100%)
- 主音轨: 0.8-1.0 (80%-100%)

### 音频不同步
**症状**: 音频和视频时长不匹配
**解决**: 系统会自动处理，确保音频列表长度正确

## 🎉 效果对比

| 特性 | 原始VideoComposer | 🎵 增强版 |
|------|------------------|----------|
| 音轨数量 | 1轨（仅语音） | 3轨（语音+背景+音效） |
| 音效支持 | ❌ | ✅ 原Coze工作流同款 |
| 背景音乐 | ❌ | ✅ 自动循环匹配 |
| 开场音效 | ❌ | ✅ 史诗感开场 |
| 音量控制 | 基础 | 精细化3轨独立控制 |
| 向下兼容 | - | ✅ 完全兼容原功能 |

## 💡 最佳实践

1. **音量平衡**: 确保语音清晰，背景音乐不抢夺主体
2. **音效时机**: 开场音效自动在合适时机播放
3. **循环无缝**: 背景音乐会智能循环，确保无缝衔接
4. **质量保证**: 所有音频自动重采样到统一规格

---

🎵 享受原Coze工作流同款的专业音效体验！